import{r as t,c as i,h as s}from"./p-DqB_q70x.js";const h="";const e=class{constructor(s){t(this,s);this.valueChanged=i(this,"valueChanged");this.fieldBlurred=i(this,"fieldBlurred")}field;isInvalid;isHidden;isDisabled;valueChanged;fieldBlurred;isTouched=false;isOpen=false;filtered=[];highlightedIndex=-1;inputEl;portal;componentWillLoad(){this.portal=document.createElement("div");this.portal.className="typeahead-portal";document.body.querySelector("yaseer-form").shadowRoot.appendChild(this.portal);document.addEventListener("mousedown",this.handleOutsideClick);window.addEventListener("resize",this.reposition);document.addEventListener("scroll",this.reposition,true)}disconnectedCallback(){this.portal?.remove();document.removeEventListener("mousedown",this.handleOutsideClick);window.removeEventListener("resize",this.reposition);document.removeEventListener("scroll",this.reposition,true)}componentDidRender(){if(this.isOpen){this.renderPortal();this.reposition()}else{this.portal.innerHTML=""}if(this.field.value){const t=(this.field.options||[]).find((t=>t[this.field.optionValue]===this.field.value));if(t){this.inputEl.value=t[this.field.optionLabel]}}}onInput=t=>{const i=t.target.value;const s=(this.field.options||[]).find((t=>t[this.field.optionLabel].toLowerCase()===i.toLowerCase()));this.valueChanged.emit({key:this.field.key,value:s?s[this.field.optionValue]:null});if(s){t.target.value=s[this.field.optionLabel]}this.filtered=(this.field.options||[]).filter((t=>t[this.field.optionLabel].toLowerCase().includes(i.toLowerCase())));this.highlightedIndex=-1;this.isOpen=this.filtered.length>0;this.reposition()};onFocus=()=>{if(this.filtered.length>0){this.isOpen=true;this.reposition()}};onBlur=()=>{setTimeout((()=>{this.isTouched=true;this.fieldBlurred.emit({key:this.field.key})}),150)};onKeyDown=t=>{if(!this.isOpen)return;if(t.key==="ArrowDown"){t.preventDefault();this.highlightedIndex=(this.highlightedIndex+1)%this.filtered.length;this.scrollHighlightedIntoView()}if(t.key==="ArrowUp"){t.preventDefault();this.highlightedIndex=(this.highlightedIndex-1+this.filtered.length)%this.filtered.length;this.scrollHighlightedIntoView()}if(t.key==="Enter"){t.preventDefault();if(this.highlightedIndex>=0){this.selectOption(this.filtered[this.highlightedIndex])}}if(t.key==="Escape"){this.isOpen=false}};renderPortal(){this.portal.innerHTML=`\n      <div class="typeahead-dropdown">\n        ${this.filtered.map(((t,i)=>`\n            <div \n              class="item ${i===this.highlightedIndex?"highlighted":""}"\n              data-index="${i}"\n              data-value="${t[this.field.optionValue]}"\n            >\n              ${t[this.field.optionLabel]}\n            </div>\n          `)).join("")}\n      </div>\n    `;this.portal.addEventListener("mousedown",this.portalClickHandler)}portalClickHandler=t=>{const i=t.target.closest(".item");if(!i)return;const s=Number(i.getAttribute("data-index"));const h=this.filtered[s];this.selectOption(h)};selectOption(t){this.valueChanged.emit({key:this.field.key,value:t[this.field.optionValue]});this.isOpen=false;this.portal.innerHTML="";this.inputEl.value=t[this.field.optionLabel]}reposition=()=>{if(!this.isOpen||!this.inputEl)return;debugger;const t=this.inputEl.getBoundingClientRect();const i=Math.min(this.filtered.length*40,260);const s=window.innerHeight-t.bottom;const h=s<i;const e=window.pageYOffset||document.documentElement.scrollTop||0;const n=window.pageXOffset||document.documentElement.scrollLeft||0;Object.assign(this.portal.style,{position:"absolute",left:`${t.left+n}px`,width:`${t.width}px`,top:h?`${t.top+e-i}px`:`${t.bottom+e}px`,zIndex:"999999"})};scrollHighlightedIntoView(){const t=this.portal.querySelector(".highlighted");t?.scrollIntoView({block:"nearest"})}handleOutsideClick=t=>{if(!this.isOpen)return;const i=t.target===this.inputEl;const s=this.portal.contains(t.target);if(!i&&!s){this.isOpen=false}};render(){if(this.isHidden)return null;return s("section",null,s("input",{ref:t=>this.inputEl=t,type:"text",disabled:this.isDisabled,placeholder:this.field.placeholder||"",onInput:this.onInput,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,class:`${this.isInvalid?"invalid":"valid"} ${this.isTouched?"touched":"untouched"}`}),this.field.label&&s("label",{htmlFor:this.field.key,innerHTML:this.field.label.replace(/\[\--(.*?)\--\]/g,' <span class="file-size-limit">($1)</span>')}),s("slot",null))}};e.style=h;export{e as typeahead_field};
//# sourceMappingURL=p-e6595005.entry.js.map