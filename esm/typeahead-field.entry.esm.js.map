{"version":3,"file":"typeahead-field.entry.esm.js","sources":["src/components/yaseer-form/components/typeahead-field/typeahead-field.css?tag=typeahead-field","src/components/yaseer-form/components/typeahead-field/typeahead-field.tsx"],"sourcesContent":["","import { Component, Event, Prop, State, h, EventEmitter } from '@stencil/core';\nimport { iFormField } from '../../models/form-field.model';\n\n@Component({\n  tag: 'typeahead-field',\n  styleUrl: 'typeahead-field.css',\n  shadow: false,\n})\nexport class TypeaheadField {\n  @Prop() field: iFormField;\n  @Prop() isInvalid: boolean;\n  @Prop() isHidden: boolean;\n  @Prop() isDisabled: boolean;\n\n  @Event({ bubbles: true, composed: true }) valueChanged: EventEmitter<{ key: string; value: any }>;\n  @Event({ bubbles: true, composed: true }) fieldBlurred: EventEmitter<{ key: string }>;\n\n  @State() isTouched = false;\n  @State() isOpen = false;\n  @State() filtered = [];\n  @State() highlightedIndex = -1;\n\n  private inputEl!: HTMLInputElement;\n  private portal!: HTMLDivElement;\n\n  // ------------------------------\n  // LIFECYCLE\n  // ------------------------------\n\n  componentWillLoad() {\n    this.portal = document.createElement('div');\n    this.portal.className = 'typeahead-portal';\n    document.body.querySelector('yaseer-form').shadowRoot.appendChild(this.portal);\n\n    // Close on outside click\n    document.addEventListener('mousedown', this.handleOutsideClick);\n    window.addEventListener('resize', this.reposition);\n    document.addEventListener('scroll', this.reposition, true);\n  }\n\n  disconnectedCallback() {\n    this.portal?.remove();\n\n    document.removeEventListener('mousedown', this.handleOutsideClick);\n    window.removeEventListener('resize', this.reposition);\n    document.removeEventListener('scroll', this.reposition, true);\n  }\n\n  componentDidRender() {\n    if (this.isOpen) {\n      this.renderPortal();\n      this.reposition();\n    } else {\n      this.portal.innerHTML = '';\n    }\n\n    if (this.field.value) {\n      const selectedOption = (this.field.options || []).find(opt =>\n        opt[this.field.optionValue] === this.field.value\n      );\n\n      if (selectedOption) {\n        this.inputEl.value = selectedOption[this.field.optionLabel];\n      }\n    }\n  }\n\n  // ------------------------------\n  // INPUT HANDLERS\n  // ------------------------------\n\n  private onInput = (e: Event) => {\n    const value = (e.target as HTMLInputElement).value;\n\n    const selectedOption = (this.field.options || []).find(opt =>\n      opt[this.field.optionLabel].toLowerCase() === value.toLowerCase()\n    );\n\n    this.valueChanged.emit({ key: this.field.key, value: selectedOption ? selectedOption[this.field.optionValue] : null });\n\n    if (selectedOption) {\n      (e.target as HTMLInputElement).value = selectedOption[this.field.optionLabel];\n    }\n\n    this.filtered = (this.field.options || []).filter(opt =>\n      opt[this.field.optionLabel]\n        .toLowerCase()\n        .includes(value.toLowerCase())\n    );\n\n    this.highlightedIndex = -1;\n    this.isOpen = this.filtered.length > 0;\n\n    this.reposition();\n  };\n\n  private onFocus = () => {\n    if (this.filtered.length > 0) {\n      this.isOpen = true;\n      this.reposition();\n    }\n  };\n\n  private onBlur = () => {\n    // allow click on items\n    setTimeout(() => {\n      this.isTouched = true;\n      this.fieldBlurred.emit({ key: this.field.key });\n    }, 150);\n  };\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    if (!this.isOpen) return;\n\n    if (e.key === 'ArrowDown') {\n      e.preventDefault();\n      this.highlightedIndex =\n        (this.highlightedIndex + 1) % this.filtered.length;\n      this.scrollHighlightedIntoView();\n    }\n\n    if (e.key === 'ArrowUp') {\n      e.preventDefault();\n      this.highlightedIndex =\n        (this.highlightedIndex - 1 + this.filtered.length) %\n        this.filtered.length;\n      this.scrollHighlightedIntoView();\n    }\n\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      if (this.highlightedIndex >= 0) {\n        this.selectOption(this.filtered[this.highlightedIndex]);\n      }\n    }\n\n    if (e.key === 'Escape') {\n      this.isOpen = false;\n    }\n  };\n\n  // ------------------------------\n  // PORTAL RENDERING\n  // ------------------------------\n  private renderPortal() {\n    this.portal.innerHTML = `\n      <div class=\"typeahead-dropdown\">\n        ${this.filtered\n        .map((o, i) => `\n            <div \n              class=\"item ${i === this.highlightedIndex ? 'highlighted' : ''}\"\n              data-index=\"${i}\"\n              data-value=\"${o[this.field.optionValue]}\"\n            >\n              ${o[this.field.optionLabel]}\n            </div>\n          `)\n        .join('')}\n      </div>\n    `;\n\n    this.portal.addEventListener('mousedown', this.portalClickHandler);\n  }\n\n  private portalClickHandler = (e: any) => {\n    const item = e.target.closest('.item');\n    if (!item) return;\n\n    const index = Number(item.getAttribute('data-index'));\n    const option = this.filtered[index];\n\n    this.selectOption(option);\n  };\n\n  private selectOption(option) {\n    this.valueChanged.emit({\n      key: this.field.key,\n      value: option[this.field.optionValue],\n    });\n\n    this.isOpen = false;\n    this.portal.innerHTML = '';\n\n    // update input value visually\n    this.inputEl.value = option[this.field.optionLabel];\n  }\n\n  // ------------------------------\n  // POSITIONING\n  // ------------------------------\n\n  private reposition = () => {\n    if (!this.isOpen || !this.inputEl) return;\n\n    debugger;\n\n    const rect = this.inputEl.getBoundingClientRect();\n    const dropdownHeight = Math.min(this.filtered.length * 40, 260);\n    const spaceBelow = window.innerHeight - rect.bottom;\n    const openAbove = spaceBelow < dropdownHeight;\n\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop || 0;\n    const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft || 0;\n\n    Object.assign(this.portal.style, {\n      position: 'absolute',\n      left: `${rect.left + scrollLeft}px`,\n      width: `${rect.width}px`,\n      top: openAbove\n        ? `${rect.top + scrollTop - dropdownHeight}px`\n        : `${rect.bottom + scrollTop}px`,\n      zIndex: '999999',\n    });\n  };\n\n  private scrollHighlightedIntoView() {\n    const highlighted = this.portal.querySelector('.highlighted');\n    highlighted?.scrollIntoView({ block: 'nearest' });\n  }\n\n  // ------------------------------\n  // OUTSIDE CLICK\n  // ------------------------------\n\n  private handleOutsideClick = (e: any) => {\n    if (!this.isOpen) return;\n\n    const clickedInsideInput = e.target === this.inputEl;\n    const clickedInsidePortal = this.portal.contains(e.target);\n\n    if (!clickedInsideInput && !clickedInsidePortal) {\n      this.isOpen = false;\n    }\n  };\n\n  // ------------------------------\n  // RENDER\n  // ------------------------------\n\n  render() {\n    if (this.isHidden) return null;\n\n    return (\n      <section>\n        <input\n          ref={(el) => (this.inputEl = el)}\n          type=\"text\"\n          disabled={this.isDisabled}\n          placeholder={this.field.placeholder || ''}\n          onInput={this.onInput}\n          onKeyDown={this.onKeyDown}\n          onFocus={this.onFocus}\n          onBlur={this.onBlur}\n          class={`${this.isInvalid ? 'invalid' : 'valid'} ${this.isTouched ? 'touched' : 'untouched'}`} />\n\n        {this.field.label && (\n          <label\n            htmlFor={this.field.key}\n            innerHTML={this.field.label.replace(/\\[\\--(.*?)\\--\\]/g, ' <span class=\"file-size-limit\">($1)</span>')}>\n          </label>\n        )}\n\n        <slot></slot>\n      </section>\n    );\n  }\n}\n"],"names":[],"mappings":"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"}